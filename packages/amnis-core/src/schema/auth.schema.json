{
  "$id": "auth",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/AuthSchema",
  "definitions": {
    "AuthSchema": {
      "type": "object",
      "properties": {
        "authenticate": {
          "$ref": "#/definitions/ApiAuthAuthenticate"
        },
        "challenge": {
          "$ref": "#/definitions/ApiAuthChallenge"
        },
        "credential": {
          "$ref": "#/definitions/ApiAuthCredential"
        },
        "register": {
          "$ref": "#/definitions/ApiAuthRegistration"
        },
        "login": {
          "$ref": "#/definitions/ApiAuthLogin"
        },
        "logout": {
          "$ref": "#/definitions/ApiAuthLogout"
        },
        "verify": {
          "$ref": "#/definitions/ApiAuthVerify"
        },
        "create": {
          "$ref": "#/definitions/ApiAuthCreate"
        },
        "typeChallenge": {
          "$ref": "#/definitions/Challenge",
          "description": "Encoded types."
        },
        "typeCrendential": {
          "$ref": "#/definitions/Credential"
        }
      },
      "additionalProperties": false
    },
    "ApiAuthAuthenticate": {
      "type": "object",
      "properties": {
        "challenge": {
          "$ref": "#/definitions/ChallengeEncoded",
          "description": "Encoded challenge object to prevent reply attacks."
        },
        "signature": {
          "$ref": "#/definitions/SignatureEncoded",
          "description": "Encoded attestation signature of the challenge object."
        }
      },
      "required": [
        "challenge",
        "signature"
      ],
      "additionalProperties": false,
      "description": "A request to authenticate with a session. User must log in if authentication fails."
    },
    "ChallengeEncoded": {
      "type": "string",
      "description": "An encoded challenge to prevent replay attacks.",
      "minLength": 16,
      "maxLength": 512
    },
    "SignatureEncoded": {
      "type": "string",
      "description": "An encoded cryptographic signature to verify that data can be trusted.",
      "minLength": 16,
      "maxLength": 512
    },
    "ApiAuthChallenge": {
      "type": "object",
      "properties": {
        "subject": {
          "type": "string",
          "minLength": 8,
          "maxLength": 32,
          "description": "Subject that the challenge only works for. A subject challenge includes an OTP."
        },
        "purpose": {
          "$ref": "#/definitions/ApiAuthChallengePurpose",
          "description": "An optional purpose title for the challenge."
        },
        "email": {
          "$ref": "#/definitions/Email",
          "description": "Email address to send the one-time-passcode to."
        },
        "signature": {
          "$ref": "#/definitions/SignatureEncoded",
          "description": "Options signature from a privileged account to return the OTP."
        }
      },
      "additionalProperties": false,
      "description": "Challenge Generation Request."
    },
    "ApiAuthChallengePurpose": {
      "type": "string",
      "enum": [
        "resetpass",
        "adddevice",
        "register",
        "confirm"
      ],
      "description": "Challenge purposes"
    },
    "Email": {
      "type": "string",
      "description": "An email address",
      "pattern": "^[\\w.-]+@([\\w-]+\\.)+[\\w-]{2,4}$",
      "maxLength": 64
    },
    "ApiAuthCredential": {
      "type": "object",
      "properties": {
        "challenge": {
          "$ref": "#/definitions/ChallengeEncoded",
          "description": "Encoded signature challenge object to prevent reply attacks with a level of authenticity using an OTP."
        },
        "credential": {
          "type": "string",
          "minLength": 16,
          "maxLength": 512
        },
        "signature": {
          "$ref": "#/definitions/SignatureEncoded",
          "description": "Encoded attestation signature of the encoded credential."
        }
      },
      "required": [
        "challenge",
        "credential",
        "signature"
      ],
      "additionalProperties": false,
      "description": "Adds a credential to an account."
    },
    "ApiAuthRegistration": {
      "type": "object",
      "properties": {
        "handle": {
          "$ref": "#/definitions/HandleName",
          "description": "The handle name to register under."
        },
        "password": {
          "$ref": "#/definitions/Password",
          "description": "The password for the registration."
        },
        "email": {
          "$ref": "#/definitions/Email",
          "description": "Email address to add to the account to receive one-time-passcodes."
        },
        "displayName": {
          "type": "string",
          "minLength": 2,
          "maxLength": 24,
          "description": "The display name to register under."
        },
        "challenge": {
          "$ref": "#/definitions/ChallengeEncoded",
          "description": "Encoded challenge object to prevent reply attacks."
        },
        "origin": {
          "type": "string",
          "minLength": 4,
          "maxLength": 32
        },
        "type": {
          "type": "string",
          "enum": [
            "auth.create",
            "webauthn.create"
          ]
        },
        "credential": {
          "type": "string",
          "minLength": 16,
          "maxLength": 512
        },
        "signature": {
          "$ref": "#/definitions/SignatureEncoded",
          "description": "Encoded attestation signature of the challenge + credential encodings."
        }
      },
      "required": [
        "handle",
        "password",
        "displayName",
        "challenge",
        "origin",
        "type",
        "credential",
        "signature"
      ],
      "additionalProperties": false,
      "description": "Payload for an registration request. A value of undefined starts a registration event."
    },
    "HandleName": {
      "type": "string",
      "description": "Human-freindly name to reference a particular subject.",
      "pattern": "^[A-Za-z0-9_-]+$",
      "minLength": 1,
      "maxLength": 24
    },
    "Password": {
      "type": "string",
      "description": "A clear-text password.",
      "minLength": 4,
      "maxLength": 32
    },
    "ApiAuthLogin": {
      "type": "object",
      "properties": {
        "handle": {
          "$ref": "#/definitions/HandleName",
          "description": "Unique name for login credentials"
        },
        "password": {
          "$ref": "#/definitions/Password",
          "description": "The login password"
        },
        "challenge": {
          "type": "string",
          "minLength": 16,
          "maxLength": 512
        },
        "$credential": {
          "type": "string",
          "minLength": 12,
          "maxLength": 40,
          "description": "Credential identifier to use on the user account."
        },
        "signature": {
          "type": "string",
          "minLength": 8,
          "maxLength": 512,
          "description": "Agent's cryptographic signature of the handle and challenge."
        }
      },
      "required": [
        "handle",
        "challenge",
        "$credential",
        "signature"
      ],
      "additionalProperties": false,
      "description": "Payload for a login request."
    },
    "ApiAuthLogout": {
      "type": "object",
      "additionalProperties": {
        "not": {}
      },
      "description": "Payload that destroys the user session and connection."
    },
    "ApiAuthVerify": {
      "$ref": "#/definitions/Bearer",
      "description": "Verifies the validity of a stringified bearer."
    },
    "Bearer": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Bearer identifier."
        },
        "exp": {
          "$ref": "#/definitions/DateNumeric",
          "description": "Expiration date."
        },
        "access": {
          "type": "string",
          "description": "Encoded access token."
        }
      },
      "required": [
        "id",
        "exp",
        "access"
      ],
      "additionalProperties": false,
      "description": "An interface for a bearer."
    },
    "DateNumeric": {
      "type": "number",
      "description": "A string that represents a JSON Date."
    },
    "ApiAuthCreate": {
      "type": "object",
      "properties": {
        "handle": {
          "$ref": "#/definitions/HandleName",
          "description": "The user handle."
        },
        "password": {
          "$ref": "#/definitions/Password",
          "description": "The account password to apply."
        },
        "email": {
          "$ref": "#/definitions/Email",
          "description": "Account email address for important account related information"
        },
        "nameDisplay": {
          "type": "string",
          "description": "Display name for the account profile."
        },
        "challenge": {
          "$ref": "#/definitions/ChallengeEncoded",
          "description": "Creation challenge."
        },
        "signature": {
          "$ref": "#/definitions/SignatureEncoded",
          "description": "Signature verification."
        }
      },
      "required": [
        "handle",
        "password",
        "challenge",
        "signature"
      ],
      "additionalProperties": false,
      "description": "Creates an account for authentication."
    },
    "Challenge": {
      "type": "object",
      "properties": {
        "$id": {
          "$ref": "#/definitions/UID",
          "description": "All objects that can be composed into an entity must have an identifier."
        },
        "value": {
          "type": "string",
          "description": "The string random value of the challenge.",
          "minLength": 16,
          "maxLength": 256
        },
        "expires": {
          "$ref": "#/definitions/DateNumeric",
          "description": "Expiration date-time of the challenge."
        },
        "$subject": {
          "$ref": "#/definitions/UID",
          "description": "The subject being challenged."
        },
        "otp": {
          "type": "string",
          "description": "An optional one-time passcode value to be generate administratively.",
          "minLength": 6,
          "maxLength": 32
        }
      },
      "required": [
        "$id",
        "expires",
        "value"
      ],
      "additionalProperties": false,
      "description": "Entity that contains data to verify credentials."
    },
    "UID": {
      "type": "string",
      "description": "A id identifier to another document.",
      "pattern": "^[a-z]{1,24}:[A-Za-z0-9_-]{16,32}$",
      "minLength": 18,
      "maxLength": 56
    },
    "Credential": {
      "type": "object",
      "properties": {
        "$id": {
          "$ref": "#/definitions/UID",
          "description": "All objects that can be composed into an entity must have an identifier."
        },
        "name": {
          "type": "string",
          "description": "Name of the credential"
        },
        "publicKey": {
          "type": "string",
          "description": "Credential's public key for verifying signatures."
        },
        "ip": {
          "type": "string",
          "description": "The IP address when the credential was registered."
        },
        "used": {
          "$ref": "#/definitions/DateJSON",
          "description": "Date-time of when the credential was last used."
        }
      },
      "required": [
        "$id",
        "name",
        "publicKey"
      ],
      "additionalProperties": false,
      "description": "Entity that contains data to verify credentials."
    },
    "DateJSON": {
      "type": "string",
      "description": "A string that represents a JSON Date.",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
    }
  }
}
